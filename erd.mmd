erDiagram
    SCHOOLS {
        SERIAL id PK "PK"
        VARCHAR name "학교명"
        VARCHAR campus "캠퍼스"
        VARCHAR domain "도메인 (UNIQUE)"
    }
    DEPARTMENTS {
        SERIAL id PK "PK"
        INT school_id FK "FK -> schools.id"
        VARCHAR name
    }
    USERS {
        UUID id PK "PK"
        INT school_id FK "FK -> schools.id"
        INT department_id FK "FK -> departments.id"
        VARCHAR email "UNIQUE"
        VARCHAR password
        VARCHAR nickname
        ENUM role
        ENUM status
        DATE birth_date
        ENUM gender
        SMALLINT admission_year
        VARCHAR student_number
        TIMESTAMP created_at
        TIMESTAMP updated_at
    }
    BOARDS {
        SERIAL id PK "PK"
        INT school_id FK "FK -> schools.id"
        VARCHAR name "Unique per school"
        TEXT description
        BOOLEAN is_public
        INT sort_order
    }
    POSTS {
        UUID id PK "PK"
        INT board_id FK "FK -> boards.id"
        UUID user_id FK "FK -> users.id"
        VARCHAR title
        TEXT content
        BOOLEAN anonymous_flag
        VARCHAR anonymous_nickname
        INT likes_count
        TIMESTAMP created_at
        TIMESTAMP updated_at
    }
    COMMENTS {
        UUID id PK "PK"
        UUID post_id FK "FK -> posts.id"
        UUID user_id FK "FK -> users.id"
        UUID parent_comment_id "NULL이면 일반 댓글"
        TEXT content
        BOOLEAN anonymous_flag
        VARCHAR anonymous_nickname
        INT likes_count
        TIMESTAMP created_at
    }
    POST_LIKES {
        SERIAL id PK "PK"
        UUID post_id FK "FK -> posts.id"
        UUID user_id FK "FK -> users.id"
        TIMESTAMP created_at
    }
    COMMENT_LIKES {
        SERIAL id PK "PK"
        UUID comment_id FK "FK -> comments.id"
        UUID user_id FK "FK -> users.id"
        TIMESTAMP created_at
    }
    CHAT_SESSIONS {
        UUID id PK "PK"
        UUID user_id FK "FK -> users.id"
        TIMESTAMP created_at
        VARCHAR Field
    }
    CHAT_LOGS {
        UUID id PK "PK"
        UUID session_id FK "FK -> chat_sessions.id"
        TEXT question
        TEXT answer
        TEXT summary
        JSONB source
        TIMESTAMP created_at
    }
    USER_CONSENTS {
        SERIAL id PK "PK"
        UUID user_id FK "FK -> users.id"
        ENUM consent_type
        BOOLEAN consent_status
        TIMESTAMP consent_date
    }
    USER_NOTIFICATIONS {
        SERIAL id PK "PK"
        UUID user_id FK "FK -> users.id"
        BOOLEAN email_alert
        BOOLEAN sms_alert
        BOOLEAN push_alert
        TIMESTAMP created_at
        TIMESTAMP updated_at
    }

    %% Relations
    SCHOOLS ||--o{ DEPARTMENTS : has
    SCHOOLS ||--o{ USERS : has
    SCHOOLS ||--o{ BOARDS : has

    DEPARTMENTS ||--o{ USERS : has

    BOARDS ||--o{ POSTS : has
    USERS ||--o{ POSTS : writes

    POSTS ||--o{ COMMENTS : has
    USERS ||--o{ COMMENTS : writes

    POSTS ||--o{ POST_LIKES : liked_in
    USERS ||--o{ POST_LIKES : likes

    COMMENTS ||--o{ COMMENT_LIKES : liked_in
    USERS ||--o{ COMMENT_LIKES : likes

    USERS ||--o{ USER_CONSENTS : gives
    USERS ||--o{ USER_NOTIFICATIONS : has

    USERS ||--o{ CHAT_SESSIONS : owns
    CHAT_SESSIONS ||--o{ CHAT_LOGS : has
